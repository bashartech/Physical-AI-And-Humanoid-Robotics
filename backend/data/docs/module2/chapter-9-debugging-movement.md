---
sidebar_position: 9
---
# Chapter 9: Debugging movement

### Introduction
Debugging robot movement in simulation is an essential skill for any robotics engineer. This chapter focuses on systematic approaches to identify and resolve issues related to a robot's locomotion, manipulation, and general physical interaction within Gazebo and Unity. We will cover common pitfalls, diagnostic tools, and best practices for ensuring your digital twin moves as intended. The goal is to build confidence in troubleshooting and refining robot behaviors.\n
### Main Sections\n\n#### 9.1 Common Movement Issues in Simulation\n*   **Theoretical Explanation:** Overview of frequent problems:\n    *   **Unstable Physics:** Jittering, explosions, unexpected forces.\n    *   **Incorrect Kinematics/Dynamics:** Robot parts not moving as expected, wrong joint limits.\n    *   **Collision Problems:** Objects passing through each other, getting stuck.\n    *   **Control Lag/Inaccuracy:** Delays in response, imprecise movements.\n    *   **Sensor Noise/Bias:** Misleading perception data affecting control.\n*   **Key Concepts:** Numerical instability, singularities, friction cones, real-time factor deviations.\n*   **[DIAGRAM: Visualizing Collision Mesh Discrepancies]**\n
#### 9.2 Gazebo Diagnostic Tools\n*   **Theoretical Explanation:** Utilizing Gazebo's built-in debugging features:\n    *   **Visualizing Forces/Torques:** Displaying applied forces and contact points.\n    *   **Joint State Inspection:** Checking joint angles, velocities, efforts directly in `gzclient`.\n    *   **Physics Parameter Tuning:** Adjusting solver iterations, update rates, friction.\n    *   **Collision Visualization:** Showing bounding boxes and collision meshes.\n    *   **Log Files:** Analyzing Gazebo's output for warnings and errors.\n*   **Key Concepts:** Debug menu, property inspector, `GAZEBO_LOG_LEVEL`.\n*   **Code Example (Concept):** Bash commands to launch Gazebo with specific debug flags.\n
#### 9.3 ROS 2 Debugging for Robot Control\n*   **Theoretical Explanation:** Using ROS 2 tools to diagnose control issues:\n    *   **`rqt_graph`:** Visualizing the ROS 2 computation graph to check node connections.\n    *   **`rqt_plot`:** Plotting topic data (e.g., commanded vs. actual joint positions, controller errors).\n    *   **`ros2 topic echo`:** Inspecting raw topic messages.\n    *   **`ros2 param get/set`:** Modifying controller parameters on the fly.\n    *   **`RViz`:** Visualizing robot state, paths, and sensor data.\n*   **Key Concepts:** Topic message introspection, data visualization, parameter server.\n*   **Code Example (Concept):** Bash commands for launching `rqt_plot` to monitor joint positions from `ros2_control`.\n
#### 9.4 Debugging in Unity for Dynamic Interactions\n*   **Theoretical Explanation:** Leveraging Unity's powerful debugging tools:\n    *   **Editor Play Mode:** Pausing, stepping through frames, inspecting object properties.\n    *   **Debug.Log:** Custom logging within C# scripts.\n    *   **Profiler:** Identifying performance bottlenecks (physics, rendering, scripts).\n    *   **Gizmos and Handles:** Drawing custom visual aids in the scene view to represent forces, raycasts, or target points.\n    *   **Physics Debug Visualizer:** Showing colliders, rigidbodies, and contact points.\n*   **Key Concepts:** Call stacks, breakpoints, frame analysis, memory usage.\n*   **Code Example (Concept):** A C# script snippet using `Debug.DrawRay` to visualize a raycast or `Gizmos.DrawWireSphere` to show a target point.\n
### Practical Assignment\n**Task:**\n1.  **Identify a Problem:** Introduce a deliberate bug into your previous robot simulation (e.g., set a joint limit incorrectly, use an unrealistic mass for a link, or introduce a small control delay in your ROS 2 node).\n2.  **Diagnose and Fix:** Use the diagnostic tools and techniques discussed (Gazebo GUI, `rqt_plot`, `ros2 topic echo`, or Unity's debugger) to pinpoint the source of the movement issue.\n3.  **Document:** Describe the bug you introduced, the tools you used to find it, and how you resolved it.\n
### Quiz\n1.  If your robot in Gazebo is exhibiting \"explosive\" behavior (rapid, uncontrolled movements), which aspect of the physics engine would you most likely investigate first?\n    a) Gravity settings\n    b) Solver iterations and update rate\n    c) Visual mesh complexity\n    d) Ambient lighting\n
2.  Name two ROS 2 command-line tools that are useful for diagnosing issues with robot joint controllers or sensor data.\n3.  How can Unity's Profiler tool assist in debugging movement issues in a digital twin, particularly when performance or responsiveness is a concern?\n